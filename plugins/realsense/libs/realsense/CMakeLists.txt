cmake_minimum_required(VERSION 3.13)

project(realsense)

include(${CMAKE_CURRENT_SOURCE_DIR}/../../../../common.cmake)

set(src_dir ${LIB_BASE_BINARY_DIR}/src)
set(output_dir ${LIB_RESULT_DIR})

include(ProcessorCount)

if(ANDROID)
  set(android_params
    -D ANDROID_USB_HOST_UVC=ON

    -D ANDROID_ABI=${ANDROID_ABI}
    -D ANDROID_PLATFORM=${ANDROID_PLATFORM}
    -D ANDROID_NATIVE_API_LEVEL=${ANDROID_NATIVE_API_LEVEL}
  )
endif()

include(ExternalProject)
ExternalProject_Add(lib_realsense
  PREFIX           ${CMAKE_BINARY_DIR}/_build
  SOURCE_DIR       ${src_dir}
  INSTALL_DIR      ${output_dir}
  UPDATE_COMMAND   ""
  PATCH_COMMAND    ""
  BUILD_ALWAYS     YES
  DOWNLOAD_COMMAND ""
#  INSTALL_COMMAND  ""
  CMAKE_ARGS
    -D BUILD_GRAPHICAL_EXAMPLES=OFF
    -D BUILD_EXAMPLES=OFF
    -D BUILD_WITH_OPENMP=ON
    -D BUILD_WITH_TM2=OFF
    -D BUILD_EXTERNAL_LIBUSB=ON

    -D CMAKE_INSTALL_PREFIX=<INSTALL_DIR>
    -D CMAKE_FIND_ROOT_PATH=${CMAKE_FIND_ROOT_PATH}
    -D CMAKE_PREFIX_PATH=${CMAKE_PREFIX_PATH}
    -D CMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}
    -D CMAKE_TOOLCHAIN_FILE=${CMAKE_TOOLCHAIN_FILE}
    -D CMAKE_FIND_ROOT_PATH_MODE_PROGRAM=${CMAKE_FIND_ROOT_PATH_MODE_PROGRAM}
    -D CMAKE_FIND_ROOT_PATH_MODE_LIBRARY=${CMAKE_FIND_ROOT_PATH_MODE_LIBRARY}
    -D CMAKE_FIND_ROOT_PATH_MODE_INCLUDE=${CMAKE_FIND_ROOT_PATH_MODE_INCLUDE}
    -D CMAKE_FIND_ROOT_PATH_MODE_PACKAGE=${CMAKE_FIND_ROOT_PATH_MODE_PACKAGE}

    ${android_params}
)
